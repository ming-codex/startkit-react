import{j as e}from"./index-zpuXQVC3.js";import{r as s}from"./react-vendor-BAcgS92z.js";import{a as t,R as n,b as i,s as r,c as l,S as o,I as c,B as d,d as h}from"./antd-B58Wp8u-.js";import"./i18n-Dt8gD94O.js";const a=new class{events=new Map;on(e,s){const t=this.events.get(e)||[];return t.push(s),this.events.set(e,t),()=>this.off(e,s)}emit(e,s){const t=this.events.get(e);t&&t.slice().forEach(e=>e(s))}off(e,s){const t=this.events.get(e);if(t)if(s){const n=t.indexOf(s);n>-1&&(t.splice(n,1),0===t.length&&this.events.delete(e))}else this.events.delete(e)}once(e,s){const t=n=>{s(n),this.off(e,t)};return this.on(e,t)}clear(){this.events.clear()}getListenerCount(e){return this.events.get(e)?.length||0}getEventNames(){return Array.from(this.events.keys())}},{Title:x,Text:m}=t,j=()=>{const[t,n]=s.useState(""),[i,h]=s.useState([]);s.useEffect(()=>a.on("demo:message",e=>{h(s=>[...s.slice(-2),e]),r.info("收到消息: "+e)}),[]);const x=()=>{t.trim()&&(a.emit("demo:message",t),n(""))};return e.jsx(l,{title:"消息通信",size:"small",style:{height:"100%"},children:e.jsxs(o,{direction:"vertical",style:{width:"100%"},children:[e.jsx(m,{type:"secondary",children:"演示基础的发布订阅模式"}),e.jsx(c,{value:t,onChange:e=>n(e.target.value),placeholder:"输入消息内容",onPressEnter:x}),e.jsx(d,{type:"primary",onClick:x,block:!0,children:"发布消息"}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx(m,{strong:!0,children:"消息历史:"}),e.jsx("div",{style:{marginTop:8,minHeight:60},children:0===i.length?e.jsx(m,{type:"secondary",children:"暂无消息"}):i.map((s,t)=>e.jsx("div",{style:{marginBottom:4},children:e.jsx(m,{code:!0,children:s})},t))})]})]})})},g=()=>{const[t,n]=s.useState(0),[i,c]=s.useState(null);s.useEffect(()=>{const e=a.on("demo:counter",e=>{n(e)}),s=a.on("demo:login",e=>{c(e),r.success(e+" 已登录")}),t=a.on("demo:logout",()=>{c(null),r.info("已退出登录")});return()=>{e(),s(),t()}},[]);const x=e=>{const s=Math.max(0,t+e);a.emit("demo:counter",s)};return e.jsx(l,{title:"状态同步",size:"small",style:{height:"100%"},children:e.jsxs(o,{direction:"vertical",style:{width:"100%"},children:[e.jsx(m,{type:"secondary",children:"演示跨组件状态管理"}),e.jsxs("div",{children:[e.jsx(m,{strong:!0,children:"计数器: "}),e.jsx(h,{count:t,style:{marginLeft:8}})]}),e.jsxs(o,{style:{width:"100%",justifyContent:"center"},children:[e.jsx(d,{onClick:()=>x(-1),disabled:0===t,children:"-"}),e.jsx(m,{strong:!0,style:{minWidth:30,textAlign:"center"},children:t}),e.jsx(d,{onClick:()=>x(1),children:"+"}),e.jsx(d,{onClick:()=>a.emit("demo:counter",0),size:"small",children:"重置"})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsx(m,{strong:!0,children:"用户状态:"}),e.jsx("div",{style:{marginTop:8},children:i?e.jsxs(o,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(m,{children:["当前用户: ",e.jsx(m,{strong:!0,children:i})]}),e.jsx(d,{onClick:()=>a.emit("demo:logout"),block:!0,children:"退出登录"})]}):e.jsx(d,{type:"primary",onClick:()=>a.emit("demo:login","用户"+Date.now().toString().slice(-3)),block:!0,children:"模拟登录"})})]})]})})},u=()=>e.jsxs("div",{style:{padding:"24px",maxWidth:1200,margin:"0 auto"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:32},children:[e.jsx(x,{level:2,children:"EventBus 演示"}),e.jsx(m,{type:"secondary",style:{fontSize:16},children:"EventBus的用法"})]}),e.jsxs(n,{gutter:[24,24],style:{minHeight:400},children:[e.jsx(i,{xs:24,lg:12,children:e.jsx(j,{})}),e.jsx(i,{xs:24,lg:12,children:e.jsx(g,{})})]})]});export{u as default};
